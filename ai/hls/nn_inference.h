#ifndef NN_INFERENCE_H
#define NN_INFERENCE_H

#include <ap_fixed.h> //fixed point data types for FPGA
#include "hls_stream.h"
#include "ap_axi_sdata.h"

#define DWIDTH 32
#define INPUT_SIZE  52
#define HIDDEN_SIZE 16
#define OUTPUT_SIZE 1

typedef ap_fixed<32,16> data_t; //time to look into this
typedef ap_axis<DWIDTH, 0, 0, 0> trans_pkt; //no side channels 

//hard coded weights and biases
static data_t linear1_w[HIDDEN_SIZE][INPUT_SIZE] =
{{ 0.09314857f, 0.10220108f, -0.02043144f, 0.11445852f, -0.01841545f, 0.01613220f, -0.05483646f, 0.06867031f, 0.10932974f, -0.08887631f, 0.10762159f, 0.01422133f, 0.08959227f, 0.00769721f, 0.05419460f, -0.01694994f, 0.11001901f, 0.02356108f, -0.06173857f, 0.03846478f, -0.06079073f, -0.02246977f, -0.05712060f, 0.09475321f, -0.10623670f, -0.06089892f, -0.03604014f, -0.08895002f, 0.01204856f, -0.13424005f, 0.12856652f, -0.11475346f, 0.11010443f, 0.02994240f, -0.03833339f, 0.09227383f, 0.02844463f, 0.11874826f, 0.02168694f, -0.03727287f, 0.04323980f, -0.03109307f, 0.06426416f, 0.12978634f, 0.08658399f, -0.05282859f, 0.08731101f, 0.03192981f, 0.07733370f, -0.07727518f, -0.13023220f, -0.04689538f },
{ -0.09349202f, 0.10089148f, 0.02765571f, 0.04485987f, 0.03148284f, -0.00000006f, 0.09564660f, -0.08568241f, 0.00058574f, -0.08181813f, 0.03040886f, -0.03531043f, 0.03014622f, -0.01699362f, 0.10211586f, -0.07747585f, -0.07813189f, -0.07789979f, 0.12941723f, 0.05085324f, 0.13845764f, -0.12143635f, -0.14438137f, -0.10409137f, -0.08876225f, 0.06095218f, 0.05470394f, 0.10807464f, -0.07870811f, -0.09018964f, 0.07835715f, -0.05109682f, 0.08921143f, -0.03110612f, 0.08034556f, -0.10619393f, -0.06805171f, 0.04336632f, 0.03082438f, -0.03580776f, 0.08197651f, 0.09384866f, -0.10102741f, -0.07471709f, 0.12650236f, -0.03927690f, -0.04206921f, -0.13231367f, -0.07290783f, 0.04173450f, -0.01654420f, -0.09847826f },
{ -0.00000025f, -0.08189287f, -0.10474443f, -0.06362177f, -0.10845386f, -0.07549389f, 0.12566836f, 0.01444435f, 0.03038275f, -0.11640582f, -0.07825990f, -0.03374000f, 0.01028107f, -0.10910538f, -0.04714485f, -0.08851441f, -0.00517253f, -0.05651175f, -0.01420865f, -0.09941427f, -0.09962936f, -0.08780335f, -0.05404171f, -0.11465992f, 0.11229473f, -0.03307258f, 0.11398490f, 0.03623163f, -0.12423847f, 0.08989561f, -0.04067359f, -0.05801364f, -0.11944012f, -0.13505608f, 0.04170118f, -0.02747068f, 0.05685615f, -0.11158891f, 0.10378743f, -0.09517035f, -0.01788452f, 0.03514960f, 0.07735670f, 0.11780311f, 0.13178311f, -0.10224180f, 0.04186785f, -0.05213230f, -0.00863399f, -0.09642568f, 0.13226220f, -0.10327408f },
{ 0.06138826f, 0.03627294f, 0.03266488f, -0.06224169f, 0.11312182f, 0.01850114f, 0.00688426f, -0.10928985f, 0.04562430f, -0.00948706f, -0.05088672f, 0.10620373f, 0.01892527f, -0.06398202f, -0.05748982f, -0.00137879f, 0.08275410f, -0.03058612f, -0.07484736f, -0.04229168f, -0.09903423f, 0.05597868f, 0.11359163f, -0.12515321f, 0.03582619f, 0.07691352f, 0.02971649f, -0.04267592f, 0.07900555f, 0.07831303f, 0.05397652f, -0.01977728f, -0.03215059f, 0.01208562f, -0.02641435f, -0.04372758f, 0.08559245f, 0.11725673f, -0.01587677f, -0.03780845f, -0.00427060f, -0.01505133f, 0.02698242f, 0.03256600f, -0.13264281f, -0.05901125f, 0.10934569f, 0.04673735f, -0.01389423f, -0.09105594f, -0.09204283f, -0.12244171f },
{ -0.03280179f, 0.03440030f, 0.07561586f, 0.05137769f, -0.10966187f, -0.07061233f, -0.01046288f, 0.12120325f, 0.00882310f, -0.02373759f, 0.04479159f, -0.04029522f, -0.07694577f, 0.08835933f, -0.05041651f, -0.02183292f, -0.13180657f, 0.09709907f, 0.10903092f, 0.05556963f, -0.09296501f, -0.12947218f, -0.10558701f, 0.10795595f, 0.07007749f, 0.12007579f, 0.07620849f, 0.04266934f, 0.00597022f, -0.10108440f, -0.11628327f, -0.12676822f, 0.06032858f, -0.06999254f, -0.02886066f, -0.08100165f, -0.02744545f, -0.09857323f, -0.09152351f, 0.03916186f, -0.04733132f, 0.07869103f, -0.05056882f, -0.10784207f, -0.03088716f, -0.07451091f, -0.04931436f, -0.13863109f, 0.07085036f, -0.10343140f, 0.06244580f, 0.06555340f },
{ 0.08622386f, -0.09349604f, 0.08688212f, -0.05289704f, 0.03895355f, 0.11729575f, -0.00837804f, -0.00000031f, -0.01989303f, -0.10288939f, 0.05388031f, -0.12471446f, 0.07329423f, 0.09089372f, 0.11820792f, -0.03840997f, -0.11963484f, 0.02574589f, 0.07179352f, -0.14362232f, -0.03641617f, -0.09008338f, -0.01875331f, -0.07380676f, -0.06079771f, -0.04967947f, -0.13628270f, 0.10666848f, 0.10936601f, -0.02751442f, -0.01846521f, -0.06153075f, -0.12973855f, -0.13273735f, 0.05315618f, -0.07358915f, -0.08667741f, -0.00919236f, -0.04413230f, -0.03803325f, 0.01084943f, -0.02239688f, -0.04136199f, -0.05999799f, -0.10544159f, 0.12416688f, -0.04798095f, 0.04383017f, -0.04106078f, 0.01878812f, 0.13564841f, 0.06134481f },
{ -0.10726241f, 0.04248798f, 0.11869729f, 0.02429046f, 0.08014489f, 0.12376916f, -0.00988722f, 0.01688997f, -0.08354400f, -0.01669548f, 0.08983759f, 0.05838548f, -0.07494885f, -0.09831198f, -0.08193184f, -0.13356341f, -0.10677234f, -0.03386685f, 0.09425903f, 0.02341437f, -0.10523868f, -0.10525701f, 0.06952250f, -0.10245376f, -0.01710794f, 0.06677613f, -0.06403942f, -0.00988217f, -0.01150862f, -0.03184060f, -0.07094607f, -0.12364106f, -0.11185480f, -0.07303635f, 0.13462964f, -0.06610715f, -0.09256613f, 0.03428706f, 0.03905853f, 0.07745113f, 0.10696950f, 0.07834499f, -0.13626166f, 0.01385955f, 0.08521122f, -0.02034973f, -0.08884258f, 0.13103648f, -0.05842989f, -0.08609348f, -0.12593822f, 0.00647273f },
{ 0.04882771f, 0.01871488f, 0.01560252f, -0.09229835f, -0.11657234f, -0.00000029f, 0.11352071f, 0.06724147f, -0.06797410f, -0.00702309f, -0.08936767f, -0.05422696f, 0.01343593f, 0.06277793f, 0.10197444f, -0.13223255f, 0.08746545f, -0.10260969f, 0.04755292f, 0.11213340f, -0.00254425f, 0.11997385f, -0.12390852f, -0.05846975f, 0.07643036f, -0.03540973f, -0.03290421f, -0.06425333f, 0.08958307f, 0.06242136f, 0.04175103f, -0.08220785f, -0.11713316f, 0.01713638f, 0.04228292f, -0.06222057f, -0.03653355f, 0.09485427f, 0.01272020f, 0.01356938f, -0.02707531f, -0.11856615f, -0.12371110f, -0.05924541f, -0.06351067f, 0.05068971f, -0.03332379f, -0.04736972f, 0.13870245f, 0.05534310f, 0.10567316f, -0.06905657f },
{ -0.04407218f, 0.03847133f, -0.07957189f, -0.07783604f, -0.00005653f, -0.03822817f, -0.09109179f, 0.06948080f, 0.09862696f, 0.01101938f, -0.01253605f, -0.11551863f, -0.03802024f, 0.02314878f, 0.05272924f, -0.02445995f, -0.06133119f, 0.07083234f, -0.11621751f, 0.08111681f, -0.06025250f, -0.00543333f, -0.03434339f, 0.01039589f, -0.04761193f, 0.09390569f, -0.01020138f, 0.10075822f, 0.12617871f, -0.07396714f, -0.10586676f, 0.10477574f, 0.10221189f, -0.11155183f, -0.01619733f, -0.14238209f, -0.11905407f, 0.02130074f, 0.03107652f, 0.03606012f, -0.03154066f, 0.13405557f, 0.02589821f, -0.07565726f, -0.00130983f, 0.04083720f, 0.05573710f, -0.09078208f, 0.05855311f, -0.06370340f, -0.10796464f, -0.08218563f },
{ 0.12079637f, 0.10563817f, 0.11125853f, 0.06863286f, 0.09189223f, -0.00750667f, -0.06356189f, 0.05659771f, -0.05914779f, -0.08075818f, -0.03190044f, 0.01719366f, 0.05868163f, -0.04132515f, -0.06884737f, 0.01172335f, -0.08843588f, -0.09680646f, 0.06610169f, -0.02992266f, 0.12018057f, 0.12748650f, 0.03450113f, 0.04102739f, 0.02614372f, -0.00484636f, -0.01668496f, -0.00571568f, 0.04448861f, 0.12217049f, -0.04084345f, -0.06537262f, -0.04015840f, -0.07200133f, 0.01844247f, 0.09848645f, 0.10354532f, 0.05853869f, -0.10719322f, -0.06766792f, -0.02418312f, -0.01877880f, 0.01761793f, -0.12103619f, 0.04951871f, -0.09822340f, -0.08048884f, -0.10759787f, 0.12745583f, -0.12407850f, 0.11092766f, -0.01027117f },
{ -0.00544952f, 0.07393986f, -0.00290617f, 0.07417114f, 0.08740971f, -0.10748520f, 0.04082908f, 0.01443186f, 0.01787394f, 0.00898764f, 0.02569750f, -0.05404042f, -0.00680145f, 0.11881867f, 0.08034167f, -0.01226695f, -0.13738343f, -0.00063591f, -0.10065375f, 0.10584234f, -0.09087703f, -0.01793866f, -0.03836673f, 0.01762932f, 0.12474994f, 0.00624311f, 0.07356723f, 0.09970284f, 0.10418774f, -0.05495091f, -0.03592156f, 0.06006742f, -0.04453877f, 0.05840939f, -0.03702921f, -0.10053629f, 0.05007867f, 0.01453482f, 0.05526525f, 0.13520601f, 0.09171435f, 0.12898330f, 0.00496376f, -0.12225138f, -0.09978111f, -0.07816708f, -0.11469645f, -0.06884161f, -0.12046304f, -0.12043209f, -0.08215968f, -0.14336644f },
{ -0.07233004f, 0.04035364f, 0.10276048f, -0.02893234f, -0.02804092f, 0.06131970f, -0.05573286f, -0.05290820f, 0.07264974f, -0.10791288f, 0.00613660f, 0.10958409f, 0.01219925f, 0.02548352f, -0.06799572f, -0.00481285f, 0.00438041f, 0.03093989f, 0.05090173f, 0.11723635f, -0.10872120f, 0.00042830f, -0.07252742f, -0.11286994f, -0.01524395f, -0.12798566f, 0.09359937f, 0.01231819f, -0.07815444f, 0.06920253f, -0.13390256f, -0.05888572f, -0.03010050f, -0.11484912f, -0.08612330f, -0.02002579f, 0.10847924f, 0.13595864f, 0.09023887f, -0.07583475f, -0.08416700f, 0.12778260f, 0.05557441f, 0.01023974f, 0.02569235f, -0.10352491f, -0.03871861f, 0.14068493f, -0.02708666f, 0.00062870f, -0.10745927f, -0.07930461f },
{ 0.00000340f, -0.07334381f, -0.00633886f, 0.04386559f, -0.12270185f, 0.02887127f, -0.07887215f, -0.05500100f, 0.04070945f, 0.09737659f, -0.02566750f, -0.04436031f, -0.11246935f, -0.05880011f, -0.10851263f, -0.03693588f, 0.02338548f, -0.13452625f, 0.11691367f, 0.08214894f, -0.14005564f, -0.07298694f, 0.03897879f, -0.03382783f, -0.01838669f, -0.06757858f, 0.10723362f, -0.08430568f, 0.10831907f, 0.00358234f, 0.02607139f, 0.10415117f, -0.02703211f, -0.07296338f, -0.01664870f, 0.11790996f, -0.09698357f, 0.03725599f, -0.13100925f, 0.07895886f, 0.05694295f, 0.01211785f, 0.06511623f, 0.00585231f, 0.08289909f, -0.10224606f, -0.01332311f, 0.06840562f, 0.14442557f, 0.07767460f, -0.09399462f, 0.10983651f },
{ -0.01893183f, -0.01767607f, -0.11311603f, -0.01041224f, 0.08524210f, 0.00818428f, -0.06800438f, 0.03033559f, -0.03207854f, 0.11368118f, -0.10744984f, -0.03143047f, -0.12095743f, -0.04206725f, 0.03134514f, 0.13823910f, 0.02808152f, 0.14025913f, 0.03084073f, 0.08476447f, 0.11517887f, 0.12217015f, -0.07170212f, 0.13247395f, 0.08694893f, -0.06008925f, -0.06215756f, -0.10990237f, 0.04102553f, -0.10735756f, 0.06000271f, 0.04786424f, -0.11646795f, 0.03290350f, -0.01523022f, 0.05872196f, 0.07442480f, -0.14180353f, 0.12278441f, 0.10806822f, 0.04715311f, -0.13488050f, -0.05725449f, -0.04820724f, -0.04376287f, 0.06979360f, 0.04224913f, 0.10170861f, -0.05956510f, 0.03850031f, 0.04123911f, -0.11500674f },
{ -0.12157280f, -0.05924504f, 0.08209539f, -0.11762028f, -0.10779282f, 0.06493634f, 0.06208779f, 0.10114787f, -0.09182160f, -0.08863748f, 0.05843243f, 0.10768165f, 0.07019524f, 0.01031638f, 0.03329333f, 0.12572111f, -0.09528317f, -0.06842019f, 0.09209879f, -0.10059649f, -0.08163466f, 0.09428874f, 0.03708686f, 0.03894325f, -0.06272686f, -0.00758634f, 0.12184153f, -0.09017688f, -0.00599817f, 0.06016656f, -0.09840722f, 0.12935962f, -0.07427299f, -0.03812851f, -0.04246866f, -0.09529617f, -0.14085969f, 0.07324520f, 0.03173720f, -0.12344400f, -0.08329313f, 0.14308250f, 0.05890051f, 0.06159158f, -0.07650827f, -0.05345201f, -0.01402680f, -0.01852441f, -0.08867306f, 0.01832773f, 0.02046161f, -0.02323331f },
{ 0.00808527f, -0.04241236f, 0.02390975f, 0.03978353f, -0.06032603f, -0.12455685f, 0.05987095f, 0.02100034f, -0.05782691f, 0.12069847f, -0.05007945f, 0.08087986f, 0.05765358f, -0.10336290f, 0.07662630f, -0.12361375f, -0.07251769f, -0.01926873f, -0.08959302f, 0.13976003f, -0.02418197f, 0.05976617f, -0.11893668f, 0.08404905f, -0.03947071f, -0.10106862f, 0.02385770f, 0.07190313f, 0.12502079f, -0.08030588f, -0.06528021f, 0.03102989f, 0.04125794f, 0.04969819f, 0.07336888f, -0.03488000f, 0.07306024f, 0.09951162f, -0.03953724f, 0.09137812f, 0.06085662f, 0.11494666f, -0.08563367f, -0.07535606f, -0.04741861f, -0.00128520f, 0.07527831f, -0.08696180f, 0.06180741f, -0.05763109f, 0.07602574f, -0.00644484f }};

static data_t linear1_b[HIDDEN_SIZE] = {-0.11488367f, -0.07221402f, -0.10163298f, 0.06952287f, -0.09128171f, -0.01314484f, 0.03084031f, -0.07632194f, 0.03362953f, -0.14189547f, -0.10613579f, -0.12797900f, -0.04058428f, -0.05124668f, 0.01472107f, -0.02910680f};

static data_t linear2_w[OUTPUT_SIZE][HIDDEN_SIZE] = {{0.12375651f, 0.23581515f, 0.09367223f, -0.10213169f, -0.23480402f, 0.09119680f, -0.12576175f, 0.12431511f, 0.15966432f, 0.08943285f, 0.22703092f, 0.23446667f, 0.05489164f, -0.18143481f, 0.21703559f, -0.11268007f }};

static data_t linear2_b[OUTPUT_SIZE] = {-0.11997359f};

inline data_t leaky_relu(data_t x);
inline data_t sigmoid(data_t x);

template<int OUT_SIZE, int IN_SIZE>
void linear_layer(const data_t W[OUT_SIZE][IN_SIZE],
                 const data_t b[OUT_SIZE],
                 const data_t in[IN_SIZE],
                 data_t out[OUT_SIZE]);

extern "C" void nn_inference(hls::stream<trans_pkt> &in_stream, hls::stream<trans_pkt> &out_stream);

#endif
